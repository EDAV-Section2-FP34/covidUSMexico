# Results

```{r}
library(forecast)
library(dplyr)
library(ggplot2)
library(zoo)

covid_MX <- read.csv("Data/COVID_mex.csv", stringsAsFactors = F)
covid_US <- read.csv("Data/COVID_usa.csv", stringsAsFactors = F)

inflation_MX <- read.csv("Data/Inflation_MX_2019_2021.csv", stringsAsFactors = F)
inflation_US <- read.csv("Data/Inflation_US_2012_2021.csv", stringsAsFactors = F)

GDP_MX <- read.csv("Data/GDP_MX_Clean.csv", stringsAsFactors = F)
GDP_US <- read.csv("Data/GDP_US_Clean.csv", stringsAsFactors = F)
```




## 1. Which economy suffered the most during the pandemic?

### Health Vertical

Th first thing that comes to mind when thinking the pandemic's effect in a particular country are daily infection cases. In order to compare such infections between countries, here we present a time-series plot to compare daily cases in each country. To make the comparison fair among the two countries, we present the cases per 100,000 population from 2020-01-25 to 2021-11-27. For visualization purposes, we compute the 7-day moving average of the series.

```{r}

aux <- covid_MX %>% inner_join(dplyr::select(covid_US, date, confirmed),
                        by=c("date"="date"))
aux$Daily_Cases_MX <- c(aux$confirmed.x[1], (aux$confirmed.x[-1]-aux$confirmed.x[-nrow(aux)])/128900000)
aux$Daily_Cases_US <- c(aux$confirmed.y[1], (aux$confirmed.y[-1]-aux$confirmed.y[-nrow(aux)])/329500000)

# Simple exponential smoothing function
ES <- function(x, l){
  s = rep(0, length(x))
  for(k in 1:length(x)){
    if(k==1){
      s[k] = x[k]
    }else{
      s[k] = l*x[k] + (1-l)*s[k-1]
    }
  }
  return(s)
}

aux[is.na(aux)] <- 0
aux <- aux %>% 
  mutate(Cases_MX = zoo::rollmean(Daily_Cases_MX, k = 7, fill = NA),
         Cases_US = zoo::rollmean(Daily_Cases_US, k = 7, fill = NA) ) %>% 
  filter(!is.na(Cases_US))
aux <- aux[-1, ]

#aux$Cases_MX <- ES(aux$Daily_Cases_MX, 0.2)
#aux$Cases_US <- ES(aux$Daily_Cases_US, 0.2)
#aux <- aux %>% filter(!is.na(Cases_US))
#aux <- aux[-1, ]

ts.plot(ts( 100000*aux$Cases_MX ),
     ts( 100000*aux$Cases_US ), col=c("darkgreen", "blue"), lty=c(1,2), lwd=2,
     xlab="", gpars=list(xaxt='n'), main="Fig. 1 Smoothed daily new cases per 100,000 population" )
legend("topleft", legend=c("MX", "US"), lty=c(1, 2), lwd=2, col=c("darkgreen", "blue"))
#abline(v=c(140, 210, 270, 410, 500, 550), col="gray", lty=2)


```

We can observe that the US consistently reports more infection cases per capita than Mexico. US also shows evidence of more waves than Mexico: two little waves before 2020-08-11, in a period in which Mexico only experienced one, and another little wave directly after the big 2020 winter wave.

Despite the previous, both countries follow a somewhat similar trend in the three big waves that we may categorize as the initial wave with peak around July 2020, the 2020 winter wave, and the most recent wave with peak around August 2021.

We now focus on what can be considered as the most important severity indicator in the pandemic: number of deaths. In the same spirit of the previous comparison, here we present daily death per  Daily deaths per 10 million population.


```{r}

aux <- covid_MX %>% inner_join(dplyr::select(covid_US, date, deaths),
                        by=c("date"="date"))
aux$Daily_Cases_MX <- c(aux$deaths.x[1], (aux$deaths.x[-1]-aux$deaths.x[-nrow(aux)])/128900000)
aux$Daily_Cases_US <- c(aux$deaths.y[1], (aux$deaths.y[-1]-aux$deaths.y[-nrow(aux)])/329500000)

#aux <- aux %>% 
#  mutate(Cases_MX = zoo::rollmean(Daily_Cases_MX, k = 7, fill = NA),
#         Cases_US = zoo::rollmean(Daily_Cases_US, k = 7, fill = NA) ) %>% 
#  filter(!is.na(Cases_US))

aux[is.na(aux)] <- 0
aux$Cases_MX <- ES(aux$Daily_Cases_MX, 0.1)
aux$Cases_US <- ES(aux$Daily_Cases_US, 0.1)
aux <- aux %>% filter(!is.na(Cases_US))

ts.plot(ts( 10000000*aux$Cases_MX ),
     ts( 10000000*aux$Cases_US ), col=c("darkgreen", "blue"), lty=c(1,2), lwd=2,
     xlab="", gpars=list(xaxt='n'), main="Fig. 2 Smoothed daily deaths per 10,000,000 population" )
indx <- c(1, 200*(1:3))
axis(side=1, at=indx, labels=aux$date[indx], cex=0.7)
legend("topleft", legend=c("MX", "US"), lty=c(1, 2), lwd=2, col=c("darkgreen", "blue"))

```

We can appreciate an interesting behavior. Unlike the reported active cases, deaths per capita are similar between the two countries, whith one being on top of the other only momentarily. Here we can see with more influence the effect of the three waves in both countries. In the first one, US started having more deaths earlier than Mexico, but was surpased by it around early July 2020 until the second wave in winter 2020 increased the deaths with more acceleration in the US but it was followed shortly after by Mexico.

Unlike the first to waves when the US preceded Mexico, in the third one it was Mexico the country that started suffering the death toll earlier, and it was followed shortly after by the US.

Both countries suffered similar death tolls across the pandemic but the US had more reported infection cases. This may be explained by the US having better healthcare system and coverage, something that Mexico may lack making infections more likely to end in a regrettable death.

### Economic Vertical

Economic growth

```{r}
aux <- 
ts.plot(ts( GDP_MX$Total[13:nrow(GDP_MX)] ),
     ts( GDP_US$Total[13:nrow(GDP_US)] ), col=c("darkgreen", "blue"), lty=c(1,2), lwd=2,
     xlab="", gpars=list(xaxt='n'), main="Fig. 3 Economic growth" )
indx <- c(1, 7*(1:3))
axis(side=1, at=indx, labels=GDP_MX$Periodo[13:nrow(GDP_MX)][indx], cex=0.8)
legend("top", legend=c("MX", "US"), lty=c(1, 2), lwd=2, col=c("darkgreen", "blue"))
text(2, -20, "202003", col="red")
abline(v=3, col="red", lwd=2, lty=3)

```

We can see that prior to March 2020, both economies had a steady economic growth (in the case of Mexico, there was a recession actually), and when the governments decided to close interaction activities, the production in the US droped to negative levels and actually tied the decrease in Mexico, so we can say the US was the economy that reacted the most at *the beginning*, from 4.42 to -1.38 (Mexico moved from -0.107 to -2.17 in the same period).

However, Mexico was the country that suffered the greatest downfall in production *across* the time window, with a huge -22.86% growth in March and a consistenly less growth in the following months except for May and June 2021, where the arithmetic effect of having a small production one year ago (first wave of the pandemic), increases the metric comparing.

It is worth nothing that it was only in the first wave that both economies suffered such an unprecedented decrease, as the second and third waves discussed above did not have the same impact as the first. The is mainly explained due to the closing policies being more relaxed after the first tight lockdown.

```{r}
aux <- GDP_MX
aux$Total <- GDP_US$Total - GDP_MX$Total
aux$Primarias <- GDP_US$Primarias - GDP_MX$Primarias
aux$Secundarias <- GDP_US$Secundarias - GDP_MX$Secundarias
aux$Terciarias <- GDP_US$Terciarias - GDP_MX$Terciarias
aux <- aux[13:nrow(aux), ]

aux %>% pivot_longer(Total:Terciarias, names_to="Diff_growth") %>% ggplot(aes(x=value, y=reorder(Diff_growth  , value, FUN = median) )) + geom_boxplot() + 
ggtitle('Fig. 4 Boxplots of the difference in growth during pandemic') +
labs(x = 'Growth US - Growth Mexico', y = 'Economic Activity')
```

## 2. Which economy had an stronger relation?

## 3. Which economy suffered the most during the pandemic?